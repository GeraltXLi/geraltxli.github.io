<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://geraltxli.github.io</id>
    <title>GeraltXLi</title>
    <updated>2021-06-03T15:12:34.692Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://geraltxli.github.io"/>
    <link rel="self" href="https://geraltxli.github.io/atom.xml"/>
    <subtitle>The flash that cuts through darkness, the light that breaks the night.</subtitle>
    <logo>https://geraltxli.github.io/images/avatar.png</logo>
    <icon>https://geraltxli.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, GeraltXLi</rights>
    <entry>
        <title type="html"><![CDATA[ClickHouseå•æœºå®‰è£…ï¼Œé«˜å¯ç”¨ç‰ˆéƒ¨ç½²å’Œç®€å•ä½¿ç”¨]]></title>
        <id>https://geraltxli.github.io/post/clickhouse-dan-ji-an-zhuang-he-gao-ke-yong-ban-bu-shu/</id>
        <link href="https://geraltxli.github.io/post/clickhouse-dan-ji-an-zhuang-he-gao-ke-yong-ban-bu-shu/">
        </link>
        <updated>2021-06-02T15:16:23.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ€è¿‘ç”¨äºOLAPåœºæ™¯çš„åˆ—å¼æ•°æ®åº“ClickHouseæŒºç«çš„ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹å®‰è£…ï¼Œéƒ¨ç½²å’Œä½¿ç”¨ã€‚ä¸è¿‡é˜¿é‡Œäº‘éƒ½æœ‰SaaSç‰ˆç›´æ¥ä½¿ç”¨äº†ï¼Œæ²¡æœ‰çš„æ‰è¦è‡ªå·±æ­ğŸ¤¡</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ€è¿‘ç”¨äºOLAPåœºæ™¯çš„åˆ—å¼æ•°æ®åº“ClickHouseæŒºç«çš„ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹å®‰è£…ï¼Œéƒ¨ç½²å’Œä½¿ç”¨ã€‚ä¸è¿‡é˜¿é‡Œäº‘éƒ½æœ‰SaaSç‰ˆç›´æ¥ä½¿ç”¨äº†ï¼Œæ²¡æœ‰çš„æ‰è¦è‡ªå·±æ­ğŸ¤¡</p>
<!-- more -->
<h1 id="å•æœºç‰ˆ">å•æœºç‰ˆ</h1>
<h2 id="1-å®‰è£…éƒ¨ç½²">1. å®‰è£…éƒ¨ç½²</h2>
<p><a href="https://clickhouse.tech/docs/en/getting-started/tutorial/">å®˜æ–¹æ–‡æ¡£</a></p>
<p>å•æœºå®‰è£…ï¼Œæ€ä¹ˆå¿«æ€ä¹ˆæ¥ï¼Œå®é™…ä¸Šå°±è¿™äº›ï¼š</p>
<pre><code class="language-bash">sudo apt-get install apt-transport-https ca-certificates dirmngr
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E0C56BD4

echo &quot;deb https://repo.clickhouse.tech/deb/stable/ main/&quot; | sudo tee \
    /etc/apt/sources.list.d/clickhouse.list
sudo apt-get update

sudo apt-get install -y clickhouse-server clickhouse-client

sudo service clickhouse-server start
clickhouse-client
</code></pre>
<h2 id="2-å¯åŠ¨å‘½ä»¤">2. å¯åŠ¨å‘½ä»¤</h2>
<p>å¦‚æœæ‰¾ä¸åˆ°serviceçš„è¯ï¼Œdebianå¯ä»¥ç›´æ¥å»è¿™ç›®å½•ï¼Œå¦å¤–ä¹Ÿå¯ä»¥çœ‹çœ‹å®é™…å¯åŠ¨å‘½ä»¤æ˜¯å•¥ï¼Œ</p>
<p>å¯åŠ¨ï¼š</p>
<pre><code class="language-bash">$debian /usr/sbin/service clickhouse-server start

# å¯åŠ¨é…ç½®è§
vim /etc/systemd/system/clickhouse-server.service
</code></pre>
<h2 id="3-é…ç½®æ–‡ä»¶">3. é…ç½®æ–‡ä»¶</h2>
<h3 id="å­˜å‚¨é…ç½®">å­˜å‚¨é…ç½®</h3>
<p>è¿™é‡Œæ˜¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æŠ„çš„å­˜å‚¨ç­–ç•¥ï¼Œç›´æ¥å†™åœ¨<code>config.d</code>ç›®å½•ä¸‹çš„<code>storage.xml</code><br>
(é»˜è®¤SSDï¼Œè§¦å‘æ¡ä»¶æ—¶è¿ç§»hdd)</p>
<pre><code class="language-xml">&lt;yandex&gt;
    &lt;storage_configuration&gt;
        &lt;disks&gt;
            &lt;fast_ssd&gt;
                &lt;path&gt;/data/fast_ssd/&lt;/path&gt;
            &lt;/fast_ssd&gt;
            &lt;hdd1&gt;
                &lt;path&gt;/home/clickhouse/hdd1/&lt;/path&gt;
            &lt;/hdd1&gt;
        &lt;/disks&gt;
        &lt;policies&gt;
            &lt;moving_from_ssd_to_hdd&gt;
                &lt;volumes&gt;
                    &lt;hot&gt;
                        &lt;disk&gt;fast_ssd&lt;/disk&gt;
                        &lt;max_data_part_size_bytes&gt;1073741824&lt;/max_data_part_size_bytes&gt;
                    &lt;/hot&gt;
                    &lt;cold&gt;
                        &lt;disk&gt;hdd1&lt;/disk&gt;
                    &lt;/cold&gt;
                &lt;/volumes&gt;
                &lt;move_factor&gt;0.2&lt;/move_factor&gt;
            &lt;/moving_from_ssd_to_hdd&gt;
        &lt;/policies&gt;
    &lt;/storage_configuration&gt;
&lt;/yandex&gt;

</code></pre>
<h2 id="4-å»ºè¡¨">4. å»ºè¡¨</h2>
<p>ä¸¾ä¸ªä¾‹å­(å®é™…ä½¿ç”¨å¿…é¡»ç¡®å®šæ¸…æ¥š<strong>è¡¨å¼•æ“</strong>å’Œ<strong>èšåˆå‡½æ•°</strong>)ï¼Œè¿™é‡Œåªæ˜¯ç°åœºæƒ³ä¸ªä¾‹å­å±•ç¤ºé¢„èšåˆç”¨æ³•:</p>
<ul>
<li>è¡¨å¼•æ“ä½¿ç”¨: <code>MergeTree</code>ï¼Œç®€å•èšåˆå‡½æ•°</li>
<li>order byå°±æ˜¯ä¸»é”®äº†</li>
<li>æŒ‰æ—¶é—´åˆ†åŒº</li>
<li>å­˜å‚¨ç­–ç•¥æ˜¯ä¼˜å…ˆSSDï¼Œä¸Šé¢é‚£ä¸ª</li>
<li>å­˜å‚¨æ—¶é—´ä¸¤ä¸ªæœˆ</li>
</ul>
<pre><code class="language-sql">create table test.user_info
(
    record_time DateTime('Asia/Shanghai'),
    user String,
    cost Float64
)ENGINE = MergeTree()
ORDER BY (record_time,user)
PARTITION BY record_time
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'
TTL record_time + INTERVAL 2 MONTH

-- åˆ›å»ºç‰©åŒ–è§†å›¾ï¼Œæ¯”å¦‚æ¯å¤©æ¯ä¸ªç”¨æˆ·costæ€»é‡
CREATE MATERIALIZED VIEW user_info_daily_mv
ENGINE = SummingMergeTree()
PARTITION BY toYYYYMM(day)
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'
ORDER BY (day,user)
AS SELECT
    toStartOfDay(record_time) AS day,
    user ,
    sum(cost) as cost_count
FROM test.user_info
GROUP BY (day,user)
</code></pre>
<h1 id="é›†ç¾¤ç‰ˆå¸¦å‰¯æœ¬">é›†ç¾¤ç‰ˆï¼ˆå¸¦å‰¯æœ¬ï¼‰</h1>
<h2 id="1-zookeeperé›†ç¾¤éƒ¨ç½²">1. zookeeperé›†ç¾¤éƒ¨ç½²</h2>
<blockquote>
<p>æ­£å¼ç¯å¢ƒè²Œä¼¼è¦è®¾ç½®zookeeperçš„æ—¥å¿—æ¸…ç†</p>
</blockquote>
<h3 id="æµ‹è¯•ç”¨composeç›´æ¥èµ·">æµ‹è¯•ç”¨composeç›´æ¥èµ·</h3>
<pre><code>version: '3.1'

services:
  zoo1:
    image: zookeeper
    restart: always
    hostname: zoo1
    ports:
      - 2181:2181
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=0.0.0.0:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo2:
    image: zookeeper
    restart: always
    hostname: zoo2
    ports:
      - 2182:2181
    environment:
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=0.0.0.0:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo3:
    image: zookeeper
    restart: always
    hostname: zoo3
    ports:
      - 2183:2181
    environment:
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=0.0.0.0:2888:3888;2181
</code></pre>
<h3 id="æ‰‹åŠ¨å®‰è£…">æ‰‹åŠ¨å®‰è£…</h3>
<p>è¿™éƒ¨åˆ†åˆ äº†ï¼Œæ‰‹åŠ¨è£…æŒºéº»çƒ¦çš„ï¼Œè¿™éƒ¨åˆ†ä¸å¤§ç¡®å®šï¼Œè™½ç„¶æ˜¯èƒ½è·‘èµ·æ¥</p>
<h2 id="2-å®‰è£…clickhouse">2. å®‰è£…clickhouse</h2>
<p>åŒä¸Š</p>
<h2 id="3-æ›´æ–°é…ç½®2åˆ†ç‰‡2å‰¯æœ¬">3. æ›´æ–°é…ç½®(2åˆ†ç‰‡2å‰¯æœ¬)</h2>
<blockquote>
<p>ä¸å»ºè®®ä¸€ä¸ªclickhouse-serveræ‹¥æœ‰ä¸¤ä¸ªreplicasæ¥è‡ªä¸åŒshardã€‚ï¼ˆé™¤äº†æ€§èƒ½é—®é¢˜ï¼Œè¿˜ä¼šå­˜åœ¨åˆ†å¸ƒå¼DDLæ— æ³•ä½¿ç”¨ï¼‰<br>
è§<a href="https://altinity.com/blog/2018/5/10/circular-replication-cluster-topology-in-clickhouse">CIRCULAR REPLICATION CLUSTER TOPOLOGY IN CLICKHOUSE</a>ä¸­çš„è®¾è®¡å’Œ<a href="https://github.com/ClickHouse/ClickHouse/issues/7611">githubä¸Šissueæ‰€æçš„é—®é¢˜</a></p>
</blockquote>
<p>å³æ¯å°æœºå™¨æ˜¯ä»£è¡¨æŸä¸ªåˆ†ç‰‡çš„æŸä¸ªå‰¯æœ¬</p>
<h3 id="æ‰€æœ‰é…ç½®æ–‡ä»¶">æ‰€æœ‰é…ç½®æ–‡ä»¶</h3>
<ul>
<li>config.xml (ä¸»é…ç½®æ–‡ä»¶)</li>
<li>users.xml (ç”¨æˆ·åŠé…ç½®é™åˆ¶)</li>
<li>storeage.xml (å­˜å‚¨ä¸ç­–ç•¥é…ç½®)</li>
<li>metrika.xmlï¼ˆé›†ç¾¤é…ç½®ï¼‰</li>
</ul>
<h3 id="configxml-ä¸»é…ç½®æ–‡ä»¶">config.xml (ä¸»é…ç½®æ–‡ä»¶)</h3>
<pre><code>&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;
</code></pre>
<h3 id="storagexml-å­˜å‚¨ä¸ç­–ç•¥é…ç½®">storage.xml (å­˜å‚¨ä¸ç­–ç•¥é…ç½®)</h3>
<p>è§å•æœºç‰ˆï¼Œå†·çƒ­æ•°æ®åˆ’åˆ†ï¼Œå®é™…è§„åˆ™</p>
<ul>
<li>partè¶…è¿‡1Gçš„è¿ç§»</li>
<li>ssdå¿«ä¸å¤Ÿå®¹é‡æ—¶è¿ç§»</li>
</ul>
<h3 id="userxmlç”¨æˆ·é…ç½®">user.xml(ç”¨æˆ·é…ç½®ï¼‰</h3>
<ul>
<li>é…ç½®æ–‡ä»¶è§<a href="https://clickhouse.tech/docs/en/operations/settings/settings-users/">user settings</a></li>
<li>å¯ä»¥è®¾ç½®ä¸ªé»˜è®¤å¯†ç ï¼Œç”¨æˆ·è´¦å·ç®¡ç†ç”¨<a href="https://clickhouse.tech/docs/en/operations/access-rights/#access-control">SQL-driven workflow</a></li>
</ul>
<h3 id="metrikaxmlæ–‡ä»¶clusteré…ç½®">metrika.xmlæ–‡ä»¶ï¼ˆclusteré…ç½®ï¼‰</h3>
<ul>
<li>ç”³è¯·4å°æœºå™¨ï¼Œä¸¤ä¸ªåˆ†ç‰‡ï¼Œ2ä¸ªå‰¯æœ¬</li>
<li>1å’Œ2çš„æœºå™¨åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸‹ï¼Œ3å’Œ4åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸‹</li>
</ul>
<pre><code class="language-xml">&lt;yandex&gt;
    &lt;remote_servers&gt;
        &lt;test_cluster&gt;
            &lt;shard&gt;
                &lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;
                &lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;!-- Optional. Priority of the replica for load balancing (see also load_balancing setting). Default: 1 (less value has more priority). --&gt;
                    &lt;!-- &lt;priority&gt;1&lt;/priority&gt; --&gt;
                    &lt;host&gt;xx.xxx.xx.xx1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx3&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx4&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_cluster&gt;
    &lt;/remote_servers&gt;

    &lt;!-- è¿™é‡Œå…¶å®å°±æ˜¯æ ‡è®°å½“å‰æœºå™¨å±äºå“ªä¸ªshardï¼Œä»¥åŠå‰¯æœ¬ä»£å· --&gt;
    &lt;macros&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;xx.xxx.xx.xx1&lt;replica&gt;
    &lt;/macros&gt;

    &lt;!-- ZK--&gt;
    &lt;zookeeper&gt;
        &lt;node index=&quot;1&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index=&quot;2&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx2&lt;/host&gt;
            &lt;port&gt;2182&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index=&quot;3&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx3&lt;/host&gt;
            &lt;port&gt;2183&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper&gt;
    
&lt;/yandex&gt;
</code></pre>
<h3 id="å®å®šä¹‰ç»Ÿä¸€å»ºè¡¨è¯­å¥">å®å®šä¹‰(ç»Ÿä¸€å»ºè¡¨è¯­å¥)</h3>
<p>è¿™é‡Œä¸è®¾ç½®layerå±‚äº†ï¼Œæ²¡å¿…è¦</p>
<h4 id="è®°å¾—æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æ›´æ–°è¿™ä¸ª"><strong>è®°å¾—æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æ›´æ–°è¿™ä¸ªï¼ï¼ï¼</strong></h4>
<h4 id="æ³¨æ„åŒä¸€ä¸ªshardçš„èŠ‚ç‚¹çš„shardé…ç½®å¿…é¡»ä¸€è‡´"><strong>æ³¨æ„åŒä¸€ä¸ªshardçš„èŠ‚ç‚¹çš„shardé…ç½®å¿…é¡»ä¸€è‡´ï¼ï¼</strong></h4>
<pre><code class="language-xml">&lt;macros&gt;
    &lt;shard&gt;01&lt;/shard&gt;
    &lt;replica&gt;hostname&lt;/replica&gt;
&lt;/macros&gt;
</code></pre>
<h4 id="å»ºè¡¨å¦‚æœå¸¦ä¸Šshardæˆ–è€…replicaä¸èƒ½ä½¿ç”¨åˆ†å¸ƒå¼ddl">å»ºè¡¨å¦‚æœå¸¦ä¸Š{shard}æˆ–è€…{replica}ï¼Œä¸èƒ½ä½¿ç”¨åˆ†å¸ƒå¼DDL</h4>
<p>å…·ä½“è§<a href="https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/replication/">å®˜æ–¹æ–‡æ¡£replicationæè¿°</a></p>
<blockquote>
<p>The replica name identifies different replicas of the same table. You can use the server name for this, as in the example. The name only needs to be unique within each shard.<br>
You can define the parameters explicitly instead of using substitutions. This might be convenient for testing and for configuring small clusters. However, you canâ€™t use distributed DDL queries (ON CLUSTER) in this case.</p>
</blockquote>
<h3 id="æœ€ç»ˆé…ç½®æ–‡ä»¶">æœ€ç»ˆé…ç½®æ–‡ä»¶</h3>
<h4 id="ä¸¢åˆ°configdç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®">ä¸¢åˆ°config.dç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®</h4>
<ul>
<li>xxx.xmlï¼ˆåˆå¹¶äº†listené…ç½®å’Œstoreageé…ç½®ï¼‰</li>
<li>metrika.xmlï¼ˆå•ç‹¬ï¼Œè¿™éƒ¨åˆ†æ˜¯çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯ï¼‰</li>
</ul>
<h4 id="ç”¨æˆ·é…ç½®ä¸¢åˆ°userdç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®">ç”¨æˆ·é…ç½®ä¸¢åˆ°user.dç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®</h4>
<ul>
<li>users.xml</li>
</ul>
<h3 id="é›†ç¾¤æ ·ä¾‹">é›†ç¾¤æ ·ä¾‹</h3>
<p>å…·ä½“å¯ä»¥å»æŸ¥çœ‹systemçš„clusterè¡¨ï¼Œçœ‹çœ‹é›†ç¾¤é…ç½®æ˜¯å¦ç”Ÿæ•ˆäº†</p>
<h2 id="4-æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨click-serverç¡®å®šäº’é€š">4. æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨click server(ç¡®å®šäº’é€š)</h2>
<ul>
<li>9000ç«¯å£ç”¨äºclickhouseäº’é€šä¸clickhouse-client</li>
<li>8123ç«¯å£ä¸ºhttpè®¿é—®</li>
</ul>
<h2 id="5-å»ºè¡¨">5. å»ºè¡¨</h2>
<pre><code class="language-sql">/*åˆ†å¸ƒå¼DDLå»ºåº“*/
CREATE DATABASE test ON CLUSTER 'test_cluster'

/*æ¯å°æœºå™¨è·‘ä¸€æ¬¡å»ºè¡¨ï¼Œä½†é€šè¿‡å®å®šä¹‰å¯ä»¥ä¿è¯æ¯ä¸ªåº“å»ºè¡¨è¯­å¥ä¸€è‡´*/
CREATE TABLE test.test_info_local (
    ......
)ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/test/test_info_local','{replica}')
PARTITION BY record_time
ORDER BY (record_time)
TTL record_time + INTERVAL 6 MONTH
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'

/*åˆ†å¸ƒå¼DDLå»ºç«‹åŸå§‹æ•°æ®åˆ†å¸ƒè¡¨*/
CREATE TABLE  test.test_info_local on CLUSTER 'test_cluster'
as test.test_info
ENGINE = Distributed(test_cluster,test,test_info_local,rand())

/*ä»¥ä¸‹ä¸å†™äº†ï¼ŒåŸºæœ¬çœ‹å®˜æ–¹æ–‡æ¡£è¯¦ç»†ç‚¹*/
/*ç‰©åŒ–è§†å›¾æœ‰å®é™…tableçš„ï¼Œåªä¸è¿‡é»˜è®¤éšè—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º*/


/*åˆ†å¸ƒå¼DDLåˆ›å»ºç‰©åŒ–è§†å›¾*/
/*è¿™é‡Œå› ä¸ºæå‰å»ºå¥½å¤åˆ¶è¡¨äº†ï¼Œä¸éœ€è¦å†è®¾ç½®engineé‚£äº›*/



/**åˆ†å¸ƒå¼DDL åˆ›å»ºå…¨å±€è§†å›¾*/

</code></pre>
<ul>
<li>æ¯ä¸ªå®ä¾‹è·‘ä¸€æ¬¡å»ºè¡¨</li>
<li>åˆ†å¸ƒå¼DDLè·‘ä¸€æ¬¡å°±å¤Ÿäº†</li>
</ul>
<h2 id="6-å®é™…åº”ç”¨">6. å®é™…åº”ç”¨</h2>
<h3 id="å†™æœ¬åœ°è¡¨">å†™æœ¬åœ°è¡¨</h3>
<p>æœ€å¥½ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œå› ä¸ºç›´æ¥å†™åˆ†å¸ƒå¼è¡¨ï¼Œåœ¨clickhouseä¸Šè¿˜è¦å†åŒæ­¥ä¸€æ¬¡ï¼Œå®é™…ä¸Šç›¸å½“äºåŒå†™äº†</p>
<h3 id="è¯»åˆ†å¸ƒå¼è¡¨">è¯»åˆ†å¸ƒå¼è¡¨</h3>
<h2 id="7-æµ‹è¯•">7. æµ‹è¯•</h2>
<p>æ€§èƒ½æ–¹é¢ç®€å•çš„å¯ä»¥çœ‹<a href="https://clickhouse.tech/docs/en/introduction/performance/">å®˜æ–¹è¯´æ˜</a>ï¼Œå°½é‡æ‰¹é‡å†™ï¼Œè¿™é‡Œå…¶å®è¿˜ä¼šæ¶‰åŠåˆ°clickhouseé‡Œpartçš„æ¦‚å¿µï¼Œä¸ç»†è¯´äº†</p>
<blockquote>
<p>We recommend inserting data in packets of at least 1000 rows, or no more than a single request per second.</p>
</blockquote>
<h2 id="8-ä¸ªäººç»éªŒ">8. ä¸ªäººç»éªŒ</h2>
<ul>
<li>è¡¨å¼•æ“è¦ç•™æ„æ¸…æ¥šï¼Œä¸ªäººä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„æ˜¯<code>SummingMergeTree</code>æˆ–è€…<code>AggregatingMergeTree</code>ï¼Œåˆ†å¸ƒå¼å°±åŠ ä¸ª<code>replica</code>å‰ç¼€</li>
<li>clickhouseå…è®¸ç›¸åŒä¸»é”®çš„æ•°æ®å­˜åœ¨ï¼Œæ˜¯å¦å»é‡ä»¥åŠå»é‡çš„è§„åˆ™å…·ä½“çœ‹è¡¨å¼•æ“å†³å®šã€‚</li>
<li>clickhouseä¸ä¿è¯part mergeçš„æ—¶æœºï¼Œè¿™ä¸ªæ˜¯å‘ï¼ŒæŸäº›å®é™…åº”ç”¨åœºæ™¯æ—¶å°±ä¼šæ„Ÿå—åˆ°çš„</li>
<li>å¯ä»¥å¯¹è§†å›¾å†è¿›è¡Œè§†å›¾çš„èšåˆï¼Œä¸è¿‡è¦æ³¨æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯insertäº‹ä»¶è§¦å‘äº†è§†å›¾ï¼Œè§†å›¾å¹¶ä¸çŸ¥é“åŸè¡¨çš„æ•°æ®</li>
</ul>
<p>æœ‰é—®é¢˜æ¬¢è¿ç•™è¨€~</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Grideaæ‰©å±•(ä¸€)- ä»£ç é«˜äº®]]></title>
        <id>https://geraltxli.github.io/post/gridea-kuo-zhan/</id>
        <link href="https://geraltxli.github.io/post/gridea-kuo-zhan/">
        </link>
        <updated>2021-05-30T14:27:40.000Z</updated>
        <summary type="html"><![CDATA[<blockquote>
<p>æ²¡æƒ³åˆ°Grideaé»˜è®¤æ²¡æœ‰ä»£ç é«˜äº®ï¼Œé‚£åªèƒ½è‡ªå·±æ¥äº†ï¼Œä½¿ç”¨<strong>highlightjs</strong>ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸»é¢˜é‡Œä»£ç ï¼Œ   å¼•å…¥ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<blockquote>
<p>æ²¡æƒ³åˆ°Grideaé»˜è®¤æ²¡æœ‰ä»£ç é«˜äº®ï¼Œé‚£åªèƒ½è‡ªå·±æ¥äº†ï¼Œä½¿ç”¨<strong>highlightjs</strong>ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸»é¢˜é‡Œä»£ç ï¼Œ   å¼•å…¥ä¸€ä¸‹å°±å¥½äº†ã€‚</p>
</blockquote>
<!-- more -->
<h2 id="ä»£ç é«˜äº®">ä»£ç é«˜äº®</h2>
<ol>
<li>ä¸‹è½½<a href="https://highlightjs.org/">highlight.js</a>ï¼Œç‚¹<code>Get Version</code>å»ä¸‹è½½è¿›è¡Œï¼Œé‡Œé¢ä¹Ÿä¸å°‘å„ç§è¯­è¨€ç­‰ä¹‹ç±»çš„é€‰æ‹©ï¼Œä¸€èˆ¬é»˜è®¤å°±å¤Ÿç”¨äº†</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://geraltxli.github.io/post-images/1622428479016.png" alt="" loading="lazy"></figure>
<ol start="2">
<li>
<p>ä¸‹è½½å®Œåè§£å‹ï¼Œç®€å•ç‚¹å°±æŠŠæ•´ä¸ªæ–‡ä»¶å¤¹<code>highlight</code>éƒ½ä¸¢åˆ°grideaæ•°æ®ç›®å½•çš„<code>static</code>ç›®å½•ä¸‹ï¼ˆä¸è¿‡å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥copyé‡Œé¢çš„<code>highlight.pack.js</code>å’Œ<code>styles</code>ç›®å½•ï¼‰</p>
</li>
<li>
<p>å»<code>themes</code>ç›®å½•ä¸‹ä¿®æ”¹ï¼Œä¸€èˆ¬åªæœ‰æ–‡ç« ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹<code>post.ejs</code>ã€‚åœ¨headé‡ŒåŠ å‡ è¡Œä»£ç å°±è¡Œäº†ï¼Œè¿™é‡Œæˆ‘é€‰äº†<code>github-dark</code>æ ·å¼ï¼Œè¿™ä¸ªçœ‹è‡ªå·±çˆ±å¥½</p>
</li>
</ol>
<pre><code class="language-html">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&lt;%= themeConfig.domain %&gt;/highlight/styles/github-dark.css&quot;&gt;
    &lt;script src=&quot;&lt;%= themeConfig.domain %&gt;/highlight/highlight.pack.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Golang-AESåŠ å¯†ï¼ˆCBCæ¨¡å¼ï¼ŒPKCS7å¡«å……ï¼‰]]></title>
        <id>https://geraltxli.github.io/post/golang-aes-jia-mi-cbc-mo-shi-pkcs7-tian-chong/</id>
        <link href="https://geraltxli.github.io/post/golang-aes-jia-mi-cbc-mo-shi-pkcs7-tian-chong/">
        </link>
        <updated>2021-05-30T13:33:56.000Z</updated>
        <summary type="html"><![CDATA[<p><a href="https://github.com/FakerGit/go-tools/tree/master/encrypt">ä»£ç åœ°å€</a></p>
<blockquote>
<p>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå³åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸€æ ·çš„å¯†é’¥çš„åŠ è§£å¯†ç®—æ³•ã€‚<br>
åˆ†ç»„å¯†ç ï¼ˆblock cipherï¼‰ï¼Œæ˜¯æ¯æ¬¡åªèƒ½å¤„ç†ç‰¹å®šé•¿åº¦çš„ä¸€å—ï¼ˆblockï¼‰æ•°æ®çš„ä¸€ç±»åŠ è§£å¯†ç®—æ³•ã€‚<br>
ç›®å‰å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•DESã€3DESã€AESéƒ½æ˜¯å±äºåˆ†ç»„å¯†ç ã€‚</p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<p><a href="https://github.com/FakerGit/go-tools/tree/master/encrypt">ä»£ç åœ°å€</a></p>
<blockquote>
<p>å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå³åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸€æ ·çš„å¯†é’¥çš„åŠ è§£å¯†ç®—æ³•ã€‚<br>
åˆ†ç»„å¯†ç ï¼ˆblock cipherï¼‰ï¼Œæ˜¯æ¯æ¬¡åªèƒ½å¤„ç†ç‰¹å®šé•¿åº¦çš„ä¸€å—ï¼ˆblockï¼‰æ•°æ®çš„ä¸€ç±»åŠ è§£å¯†ç®—æ³•ã€‚<br>
ç›®å‰å¸¸è§çš„å¯¹ç§°åŠ å¯†ç®—æ³•DESã€3DESã€AESéƒ½æ˜¯å±äºåˆ†ç»„å¯†ç ã€‚</p>
</blockquote>
<!-- more -->
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>Golangæ²¡æœ‰åƒPHPé‚£æ ·æä¾›ä¸€ä¸ªç°æˆçš„aesåŠ å¯†å‡½æ•°ï¼Œä¸è¿‡æ ‡å‡†åº“é‡Œæœ‰cryptoï¼Œåˆ©ç”¨é‡Œé¢çš„aesç­‰å¯ä»¥è‡ªå·±å°è£…ä¸ªåŠ å¯†å‡½æ•°ï¼Œä¸è¿‡éœ€è¦ç†è§£ä¸‹æ•´ä¸ªåŠ è§£å¯†çš„è¿‡ç¨‹å’ŒåŸç†</p>
<!-- more -->
<hr>
<h3 id="aesåŠ å¯†è¯¦è§£">AESåŠ å¯†è¯¦è§£</h3>
<h4 id="1-å‚è€ƒæ–‡ç« golang-ä¸­aesåŠ å¯†è¯¦è§£">1. å‚è€ƒæ–‡ç« <a href="https://blog.csdn.net/xiaohu50/article/details/51682849">golang ä¸­AESåŠ å¯†è¯¦è§£</a></h4>
<h4 id="2-è¿™é‡Œä½¿ç”¨çš„æ˜¯aesåŠ å¯†ä¸­çš„cbcæ¨¡å¼å—åŠ å¯†éœ€è¦åˆ’åˆ†æˆæ•´æ•°é•¿åº¦ç›¸ç­‰ä¸ªæ¶ˆæ¯å—ä¸æ–­åŠ å¯†ä¸²è¡Œåˆ†ç»„é•¿åº¦æ˜¯å›ºå®š128ä½ä½†å¯†é’¥çš„é•¿åº¦å¯ä»¥ä½¿ç”¨128ä½192ä½æˆ–è€…256ä½è¿™é‡ŒæŒ‡çš„æ˜¯bitå³å¯†é’¥162432é•¿åº¦å¯¹åº”aes-128-aes-192-aes-256">2. è¿™é‡Œä½¿ç”¨çš„æ˜¯AESåŠ å¯†ä¸­çš„CBCæ¨¡å¼ï¼Œå—åŠ å¯†éœ€è¦åˆ’åˆ†æˆæ•´æ•°é•¿åº¦ç›¸ç­‰ä¸ªæ¶ˆæ¯å—ä¸æ–­åŠ å¯†ï¼ˆä¸²è¡Œï¼‰ï¼Œåˆ†ç»„é•¿åº¦æ˜¯å›ºå®š128ä½ï¼Œä½†å¯†é’¥çš„é•¿åº¦å¯ä»¥ä½¿ç”¨128ä½ï¼Œ192ä½æˆ–è€…256ä½ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯bitï¼‰ï¼Œå³å¯†é’¥16ï¼Œ24ï¼Œ32é•¿åº¦å¯¹åº”AES-128, AES-192, AES-256ã€‚</h4>
<h4 id="3åˆå§‹å‘é‡è¦æ±‚éšæœºä½†ä¸éœ€è¦ä¿å¯†">3.åˆå§‹å‘é‡è¦æ±‚éšæœºï¼Œä½†ä¸éœ€è¦ä¿å¯†ã€‚</h4>
<hr>
<h3 id="ä»£ç ">ä»£ç </h3>
<p>è‡ªå·±ç ”ç©¶ä»£ç æ¯”è¾ƒæ¸…æ™°ï¼Œæ ¹æ®<a href="https://golang.org/src/crypto/cipher/example_test.go">golangæ ‡å‡†åº“AESå®ä¾‹ä»£ç </a>ï¼Œå†å‚è€ƒç½‘ä¸Šçš„PKCS7å¡«å……ï¼Œæœ€åè¿›è¡Œbase64çš„ç¼–ç ï¼ˆå› ä¸ºåŠ å¯†åæœ‰äº›å­—ç¬¦ä¸å¯è§ï¼‰ã€‚æœ€åEncryptå’ŒDncryptä¸¤ä¸ªå°±æ˜¯AESåŠ è§£å¯†ï¼ˆCBCæ¨¡å¼ï¼ŒPKCS7å¡«å……ï¼‰å°è£…åçš„å‡½æ•°ï¼Œå¯†é’¥ä½æ•°é™å®š16,24,32ï¼ˆè¦æ³¨æ„çš„æ˜¯å¯†é’¥æ— è®ºå¤šå°‘ï¼Œblocksizeéƒ½æ˜¯å›ºå®š16ï¼‰</p>
<pre><code class="language-go">package encrypt

import (
   &quot;bytes&quot;
   &quot;crypto/aes&quot;
   &quot;io&quot;
   &quot;crypto/rand&quot;
   &quot;crypto/cipher&quot;
   &quot;encoding/base64&quot;
)

/*CBCåŠ å¯† æŒ‰ç…§golangæ ‡å‡†åº“çš„ä¾‹å­ä»£ç 
ä¸è¿‡é‡Œé¢æ²¡æœ‰å¡«å……çš„éƒ¨åˆ†,æ‰€ä»¥è¡¥ä¸Š
*/

//ä½¿ç”¨PKCS7è¿›è¡Œå¡«å……ï¼ŒIOSä¹Ÿæ˜¯7
func PKCS7Padding(ciphertext []byte, blockSize int) []byte {
   padding := blockSize - len(ciphertext) % blockSize
   padtext := bytes.Repeat([]byte{byte(padding)}, padding)
   return append(ciphertext, padtext...)
}

func PKCS7UnPadding(origData []byte) []byte {
   length := len(origData)
   unpadding := int(origData[length-1])
   return origData[:(length - unpadding)]
}

//aesåŠ å¯†ï¼Œå¡«å……ç§˜é’¥keyçš„16ä½ï¼Œ24,32åˆ†åˆ«å¯¹åº”AES-128, AES-192, or AES-256.
func AesCBCEncrypt(rawData,key []byte) ([]byte, error) {
   block, err := aes.NewCipher(key)
   if err != nil {
   	panic(err)
   }

   //å¡«å……åŸæ–‡
   blockSize := block.BlockSize()
   rawData = PKCS7Padding(rawData, blockSize)
   //åˆå§‹å‘é‡IVå¿…é¡»æ˜¯å”¯ä¸€ï¼Œä½†ä¸éœ€è¦ä¿å¯†
   cipherText := make([]byte,blockSize+len(rawData))
   //blockå¤§å° 16
   iv := cipherText[:blockSize]
   if _, err := io.ReadFull(rand.Reader,iv); err != nil {
   	panic(err)
   }

   //blockå¤§å°å’Œåˆå§‹å‘é‡å¤§å°ä¸€å®šè¦ä¸€è‡´
   mode := cipher.NewCBCEncrypter(block,iv)
   mode.CryptBlocks(cipherText[blockSize:],rawData)

   return cipherText, nil
}

func AesCBCDncrypt(encryptData, key []byte) ([]byte,error) {
   block, err := aes.NewCipher(key)
   if err != nil {
   	panic(err)
   }

   blockSize := block.BlockSize()

   if len(encryptData) &lt; blockSize {
   	panic(&quot;ciphertext too short&quot;)
   }
   iv := encryptData[:blockSize]
   encryptData = encryptData[blockSize:]

   // CBC mode always works in whole blocks.
   if len(encryptData)%blockSize != 0 {
   	panic(&quot;ciphertext is not a multiple of the block size&quot;)
   }

   mode := cipher.NewCBCDecrypter(block, iv)

   // CryptBlocks can work in-place if the two arguments are the same.
   mode.CryptBlocks(encryptData, encryptData)
   //è§£å¡«å……
   encryptData = PKCS7UnPadding(encryptData)
   return encryptData,nil
}


func Encrypt(rawData,key []byte) (string,error) {
   data, err:= AesCBCEncrypt(rawData,key)
   if err != nil {
   	return &quot;&quot;,err
   }
   return base64.StdEncoding.EncodeToString(data),nil
}

func Dncrypt(rawData string,key []byte) (string,error) {
   data,err := base64.StdEncoding.DecodeString(rawData)
   if err != nil {
   	return &quot;&quot;,err
   }
   dnData,err := AesCBCDncrypt(data,key)
   if err != nil {
   	return &quot;&quot;,err
   }
   return string(dnData),nil
}
</code></pre>
<pre><code class="language-json">{
    &quot;json&quot;:&quot;123&quot;,
    &quot;hah&quot;:&quot;123&quot;
}
</code></pre>
<hr>
<p><a href="https://github.com/FakerGit/go-tools">githubä»£ç åœ°å€</a></p>
<hr>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/xiaohu50/article/details/51682849">golang ä¸­AESåŠ å¯†è¯¦è§£</a></li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€æ¬¡å®Œæ•´çš„ç½‘ç»œè¯·æ±‚è¿‡ç¨‹]]></title>
        <id>https://geraltxli.github.io/post/yi-ci-wan-zheng-de-wang-luo-qing-qiu-guo-cheng/</id>
        <link href="https://geraltxli.github.io/post/yi-ci-wan-zheng-de-wang-luo-qing-qiu-guo-cheng/">
        </link>
        <updated>2021-05-30T07:03:38.000Z</updated>
        <summary type="html"><![CDATA[<p>ä»æµè§ˆå™¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶æ‰€å‘ç”Ÿçš„äº‹æƒ…</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä»æµè§ˆå™¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶æ‰€å‘ç”Ÿçš„äº‹æƒ…</p>
<!-- more -->
<!-- more -->
<h2 id="ä¸€-dnsè§£æ">ä¸€ã€ DNSè§£æ</h2>
<ul>
<li>æµè§ˆå™¨æœç´¢è‡ªèº«ç¼“å­˜çš„DNSè®°å½•ï¼ˆæ‰€ä»¥æ‰ä¼šæœ‰ä¿®æ”¹hoståæœ‰æ—¶å€™æ²¡ç«‹åˆ»ç”Ÿæ•ˆçš„åŸå› ï¼‰</li>
<li>æœç´¢ç³»ç»Ÿçš„hostsæ–‡ä»¶</li>
<li>è·¯ç”±å™¨ä¹Ÿæœ‰DNSç¼“å­˜</li>
<li>æ— åˆ™ç»§ç»­å‘ISPçš„DNSæœåŠ¡è¯·æ±‚</li>
<li>æ— 
<ul>
<li>éè½¬å‘æ¨¡å¼ï¼šåˆ™å‘æ ¹æœåŠ¡å™¨è¯·æ±‚ï¼Œè¿›è¡Œé€’å½’æŸ¥è¯¢ï¼Œå³æ ¹DNSæœåŠ¡å™¨è¿”å›å®šä¹‰åŸŸåæœåŠ¡å™¨çš„IPï¼Œç„¶ååˆ°é¡¶çº§åŸŸåï¼ˆå¦‚<code>.com</code>æœåŠ¡å™¨æŸ¥è¯¢ï¼‰è§£æï¼Œå¦‚æœæ— æ³•è§£æå°±ä¼šç»§ç»­æä¾›æ­¤ä¸‹ä¸€çº§dnsæœåŠ¡å™¨ï¼ˆå¦‚<code>qq.com</code>å»è§£æï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä½ç½®</li>
<li>è½¬å‘æ¨¡å¼ï¼šdnsæœåŠ¡å™¨è‡ªèº«è¯·æ±‚è½¬å‘ç»™ä¸Šä¸€çº§</li>
</ul>
</li>
</ul>
<blockquote>
<p>ä»å®¢æˆ·ç«¯åˆ°æœ¬åœ°DNSæœåŠ¡å™¨æ˜¯å±äºé€’å½’æŸ¥è¯¢ï¼Œè€ŒDNSæœåŠ¡å™¨ä¹‹é—´å°±æ˜¯çš„äº¤äº’æŸ¥è¯¢å°±æ˜¯è¿­ä»£æŸ¥è¯¢ã€‚</p>
</blockquote>
<h2 id="äºŒ-tcpip-åè®®æ ˆé€šä¿¡è¿‡ç¨‹">äºŒã€TCP/IP åè®®æ ˆé€šä¿¡è¿‡ç¨‹</h2>
<figure data-type="image" tabindex="1"><img src="https://geraltxli.github.io/post-images/1622358377997.png" alt="" loading="lazy"></figure>
<h3 id="1-åº”ç”¨å±‚">1. åº”ç”¨å±‚</h3>
<p>å®šä¹‰æ•°æ®æ ¼å¼ï¼Œå¹¶æŒ‰ç…§æ ¼å¼è§£ææ•°æ®ã€‚<br>
æ­¤æ—¶æ˜¯HTTPåè®®ï¼Œheaderçš„content-typeå®šä¹‰æ ¼å¼ï¼Œbodyå¡«æ•°æ®</p>
<h3 id="2-ä¼ è¾“å±‚">2. ä¼ è¾“å±‚</h3>
<h4 id="åè®®æ ˆä¸Š">åè®®æ ˆä¸Š</h4>
<p>æ·»åŠ äº†TCPé¦–éƒ¨ï¼Œè®°å½•ç«¯å£ï¼Œç¡®è®¤ä¸»æœºä¸Šåº”ç”¨ç¨‹åºçš„èº«ä»½ï¼ŒæŠŠæ•°æ®åŒ…äº¤ç»™å¯¹åº”çš„åº”ç”¨ç¨‹åº</p>
<h4 id="tcpä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹">TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹</h4>
<figure data-type="image" tabindex="2"><img src="https://geraltxli.github.io/post-images/1622358358701.png" alt="" loading="lazy"></figure>
<blockquote>
<p>ESTABLISHED <code>É™ËˆstabliSHt</code> å·²å»ºç«‹æˆåŠŸçš„çŠ¶æ€</p>
</blockquote>
<ul>
<li>ä¸ºä»€ä¹ˆæ¡æ‰‹è¦ä¸‰æ¬¡ï¼Ÿä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ åˆ°æœåŠ¡ç«¯</li>
<li>ä¸ºä»€ä¹ˆæŒ¥æ‰‹è¦å››æ¬¡ï¼Ÿå½“Serverç«¯æ”¶åˆ°FINæŠ¥æ–‡æ—¶ï¼Œå¾ˆå¯èƒ½å¹¶ä¸ä¼šç«‹å³å…³é—­SOCKETï¼Œæ‰€ä»¥åªèƒ½å…ˆå›å¤ä¸€ä¸ªACKæŠ¥æ–‡ï¼Œå‘Šè¯‰Clientç«¯</li>
<li>ä¸ºä»€ä¹ˆTIME_WAITçŠ¶æ€éœ€è¦ç»è¿‡2MSLï¼ˆmax segment lifetimeï¼Œå³æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´ï¼Œä¸€èˆ¬1åˆ†é’Ÿåˆ°4åˆ†é’Ÿ)æ‰èƒ½è¿”å›åˆ°CLOSEçŠ¶æ€ï¼Ÿå››ä¸ªæŠ¥æ–‡éƒ½å‘é€å®Œæ¯•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›å…¥CLOSEçŠ¶æ€äº†ï¼Œ
<ul>
<li>ä½†æ˜¯æˆ‘ä»¬å¿…é¡»å‡è±¡ç½‘ç»œæ˜¯ä¸å¯é çš„ï¼Œæœ‰å¯ä»¥æœ€åä¸€ä¸ªACKä¸¢å¤±ã€‚æ‰€ä»¥TIME_WAITçŠ¶æ€å°±æ˜¯ç”¨æ¥é‡å‘å¯èƒ½ä¸¢å¤±çš„ACKæŠ¥æ–‡ã€‚</li>
<li>ä¿è¯æ­¤æ¬¡è¿æ¥çš„é‡å¤æ•°æ®æ®µä»ç½‘ç»œä¸­æ¶ˆå¤±<br>
TCPåˆ†èŠ‚å¯èƒ½ç”±äºè·¯ç”±å™¨å¼‚å¸¸è€Œâ€œè¿·è·¯â€ï¼Œåœ¨â€œè¿·è·¯â€æœŸé—´ï¼ŒTCPå‘é€ç«¯å¯èƒ½å› ç¡®è®¤è¶…æ—¶è€Œé‡å‘è¿™ä¸ªåˆ†èŠ‚ï¼Œâ€œè¿·è·¯â€çš„åˆ†èŠ‚åœ¨è·¯ç”±å™¨æ¢å¤æ­£å¸¸åä¹Ÿä¼šè¢«å‘é€åˆ°æœ€ç»ˆçš„ç›®çš„åœ°ï¼Œè¿™ä¸ªè¿Ÿåˆ°çš„â€œè¿·è·¯â€åˆ†èŠ‚åˆ°è¾¾æ—¶å¯èƒ½ä¼šå¼•èµ·é—®é¢˜ã€‚åœ¨å…³é—­â€œå‰ä¸€ä¸ªè¿æ¥â€ä¹‹åï¼Œé©¬ä¸Šåˆå»ºç«‹èµ·ä¸€ä¸ªç›¸åŒçš„IPå’Œç«¯å£ä¹‹é—´çš„â€œæ–°è¿æ¥â€ï¼Œè¿™ä¼šå¯¼è‡´â€œå‰ä¸€ä¸ªè¿æ¥â€çš„è¿·è·¯é‡å¤åˆ†ç»„åœ¨â€œå‰ä¸€ä¸ªè¿æ¥â€ç»ˆæ­¢ååˆ°è¾¾ï¼Œä»è€Œè¢«â€œæ–°è¿æ¥â€æ¥æ”¶åˆ°äº†ã€‚<br>
ä¸ºäº†é¿å…ä»¥ä¸Šæƒ…å†µï¼ŒTCP/IPåè®®ä¸å…è®¸å¤„äºTIME_WAITçŠ¶æ€çš„è¿æ¥å¯åŠ¨ä¸€ä¸ªæ–°çš„å¯ç”¨è¿æ¥ï¼Œå› ä¸ºTIME_WAITçŠ¶æ€æŒç»­2MSLï¼Œè¿™å°±å¯ä»¥ä¿è¯å½“æˆåŠŸå»ºç«‹ä¸€ä¸ªæ–°TCPè¿æ¥çš„æ—¶å€™ï¼Œæ¥è‡ªæ—§è¿æ¥é‡å¤åˆ†ç»„å·²ç»åœ¨ç½‘ç»œä¸­æ¶ˆå¤±ã€‚</li>
</ul>
</li>
</ul>
<h3 id="3-ç½‘ç»œå±‚">3. ç½‘ç»œå±‚</h3>
<p>å®šä¹‰ç½‘ç»œåœ°å€ï¼ŒåŒºåˆ†ç½‘æ®µï¼Œå­ç½‘å†…MACå¯»å€ï¼Œå¯¹ä¸åŒå­ç½‘çš„æ•°æ®åŒ…è¿›è¡Œè·¯ç”±</p>
<ul>
<li>IPåè®®é€šè¿‡å­ç½‘æ©ç è®¡ç®—ç½‘ç»œåœ°å€ï¼Œåˆ¤æ–­ä¸¤ä¸ªä¸»æœºæ˜¯å¦å±äºåŒä¸€ä¸ªå­ç½‘</li>
<li>ARPåè®®ä»¥å¤ªç½‘å¹¿æ’­ç»™å­ç½‘çš„æ‰€æœ‰ä¸»æœºï¼ŒIPåœ°å€ç›¸åŒçš„è¯ï¼Œä¸»æœºä¼šè¿”å›MACåœ°å€ï¼Œä¸åŒåˆ™ä¸¢å¼ƒã€‚ä¸æ­¤åŒæ—¶ï¼ŒARPä¼šç¼“å­˜è¿™ä¸ªæ˜ å°„å…³ç³»ã€‚æ­¤æ—¶å¯»å€é™åˆ¶äºåŒä¸€ä¸ªå­ç½‘</li>
<li>è·¯ç”±åè®®ï¼Œä¸åŒå­ç½‘ï¼Œé€šè¿‡æœ¬å­ç½‘çš„ç½‘å…³è¿›è¡Œè·¯ç”±</li>
<li></li>
</ul>
<h3 id="4-é“¾è·¯å±‚">4. é“¾è·¯å±‚</h3>
<ul>
<li>å¯¹ç”µä¿¡å·è¿›è¡Œåˆ†ç»„å¹¶å½¢æˆå…·æœ‰ç‰¹å®šæ„ä¹‰çš„æ•°æ®å¸§ï¼Œç„¶åä»¥å¹¿æ’­çš„å½¢å¼é€šè¿‡ç‰©ç†ä»‹è´¨å‘é€ç»™æ¥æ”¶æ–¹ã€‚ä»¥å¤ªç½‘è§„å®šä¸€ç»„ç”µä¿¡å·å°±æ˜¯ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä¸€ä¸ªæ•°æ®åŒ…è¢«ç§°ä¸ºä¸€å¸§ï¼Œ åˆ¶å®šè¿™ä¸ªè§„åˆ™çš„åè®®å°±æ˜¯ä»¥å¤ªç½‘åè®®ã€‚</li>
<li>å­ç½‘å¹¿æ’­ï¼Œä¸»æœºé€šè¿‡MACåœ°å€æ¥å†³å®šæ˜¯å¦å¤„ç†æ•°æ®</li>
</ul>
]]></content>
    </entry>
</feed>