<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ClickHouseå•æœºå®‰è£…ï¼Œé«˜å¯ç”¨ç‰ˆéƒ¨ç½²å’Œç®€å•ä½¿ç”¨ | GeraltXLi</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://geraltxli.github.io/favicon.ico?v=1622734895439">
<link rel="stylesheet" href="https://geraltxli.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-7NMQS8RTNS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7NMQS8RTNS');
</script>


    <meta name="description" content="æœ€è¿‘ç”¨äºOLAPåœºæ™¯çš„åˆ—å¼æ•°æ®åº“ClickHouseæŒºç«çš„ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹å®‰è£…ï¼Œéƒ¨ç½²å’Œä½¿ç”¨ã€‚ä¸è¿‡é˜¿é‡Œäº‘éƒ½æœ‰SaaSç‰ˆç›´æ¥ä½¿ç”¨äº†ï¼Œæ²¡æœ‰çš„æ‰è¦è‡ªå·±æ­ğŸ¤¡

å•æœºç‰ˆ
1. å®‰è£…éƒ¨ç½²
å®˜æ–¹æ–‡æ¡£
å•æœºå®‰è£…ï¼Œæ€ä¹ˆå¿«æ€ä¹ˆæ¥ï¼Œå®é™…ä¸Šå°±è¿™äº›ï¼š
sudo ap..." />
    <meta name="keywords" content="clickhouse" />
    <link rel="stylesheet" type="text/css" href="https://geraltxli.github.io/highlight/styles/github-dark.css">
    <script src="https://geraltxli.github.io/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://geraltxli.github.io">
        <img src="https://geraltxli.github.io/images/avatar.png?v=1622734895439" class="site-logo">
        <h1 class="site-title">GeraltXLi</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://geraltxli.github.io" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="https://geraltxli.github.io/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="https://geraltxli.github.io/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://geraltxli.github.io/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      The flash that cuts through darkness, the light that breaks the night.
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/GeraltXLi" target="_blank">GeraltXLi</a> | <a class="rss" href="https://geraltxli.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ClickHouseå•æœºå®‰è£…ï¼Œé«˜å¯ç”¨ç‰ˆéƒ¨ç½²å’Œç®€å•ä½¿ç”¨</h2>
            <div class="post-date">2021-06-02</div>
            
              <div class="feature-container" style="background-image: url('https://geraltxli.github.io/post-images/clickhouse-dan-ji-an-zhuang-he-gao-ke-yong-ban-bu-shu.jpg')">
              </div>
            
            <div class="post-content" v-pre>
              <p>æœ€è¿‘ç”¨äºOLAPåœºæ™¯çš„åˆ—å¼æ•°æ®åº“ClickHouseæŒºç«çš„ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹å®‰è£…ï¼Œéƒ¨ç½²å’Œä½¿ç”¨ã€‚ä¸è¿‡é˜¿é‡Œäº‘éƒ½æœ‰SaaSç‰ˆç›´æ¥ä½¿ç”¨äº†ï¼Œæ²¡æœ‰çš„æ‰è¦è‡ªå·±æ­ğŸ¤¡</p>
<!-- more -->
<h1 id="å•æœºç‰ˆ">å•æœºç‰ˆ</h1>
<h2 id="1-å®‰è£…éƒ¨ç½²">1. å®‰è£…éƒ¨ç½²</h2>
<p><a href="https://clickhouse.tech/docs/en/getting-started/tutorial/">å®˜æ–¹æ–‡æ¡£</a></p>
<p>å•æœºå®‰è£…ï¼Œæ€ä¹ˆå¿«æ€ä¹ˆæ¥ï¼Œå®é™…ä¸Šå°±è¿™äº›ï¼š</p>
<pre><code class="language-bash">sudo apt-get install apt-transport-https ca-certificates dirmngr
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv E0C56BD4

echo &quot;deb https://repo.clickhouse.tech/deb/stable/ main/&quot; | sudo tee \
    /etc/apt/sources.list.d/clickhouse.list
sudo apt-get update

sudo apt-get install -y clickhouse-server clickhouse-client

sudo service clickhouse-server start
clickhouse-client
</code></pre>
<h2 id="2-å¯åŠ¨å‘½ä»¤">2. å¯åŠ¨å‘½ä»¤</h2>
<p>å¦‚æœæ‰¾ä¸åˆ°serviceçš„è¯ï¼Œdebianå¯ä»¥ç›´æ¥å»è¿™ç›®å½•ï¼Œå¦å¤–ä¹Ÿå¯ä»¥çœ‹çœ‹å®é™…å¯åŠ¨å‘½ä»¤æ˜¯å•¥ï¼Œ</p>
<p>å¯åŠ¨ï¼š</p>
<pre><code class="language-bash">$debian /usr/sbin/service clickhouse-server start

# å¯åŠ¨é…ç½®è§
vim /etc/systemd/system/clickhouse-server.service
</code></pre>
<h2 id="3-é…ç½®æ–‡ä»¶">3. é…ç½®æ–‡ä»¶</h2>
<h3 id="å­˜å‚¨é…ç½®">å­˜å‚¨é…ç½®</h3>
<p>è¿™é‡Œæ˜¯å‚è€ƒå®˜æ–¹æ–‡æ¡£æŠ„çš„å­˜å‚¨ç­–ç•¥ï¼Œç›´æ¥å†™åœ¨<code>config.d</code>ç›®å½•ä¸‹çš„<code>storage.xml</code><br>
(é»˜è®¤SSDï¼Œè§¦å‘æ¡ä»¶æ—¶è¿ç§»hdd)</p>
<pre><code class="language-xml">&lt;yandex&gt;
    &lt;storage_configuration&gt;
        &lt;disks&gt;
            &lt;fast_ssd&gt;
                &lt;path&gt;/data/fast_ssd/&lt;/path&gt;
            &lt;/fast_ssd&gt;
            &lt;hdd1&gt;
                &lt;path&gt;/home/clickhouse/hdd1/&lt;/path&gt;
            &lt;/hdd1&gt;
        &lt;/disks&gt;
        &lt;policies&gt;
            &lt;moving_from_ssd_to_hdd&gt;
                &lt;volumes&gt;
                    &lt;hot&gt;
                        &lt;disk&gt;fast_ssd&lt;/disk&gt;
                        &lt;max_data_part_size_bytes&gt;1073741824&lt;/max_data_part_size_bytes&gt;
                    &lt;/hot&gt;
                    &lt;cold&gt;
                        &lt;disk&gt;hdd1&lt;/disk&gt;
                    &lt;/cold&gt;
                &lt;/volumes&gt;
                &lt;move_factor&gt;0.2&lt;/move_factor&gt;
            &lt;/moving_from_ssd_to_hdd&gt;
        &lt;/policies&gt;
    &lt;/storage_configuration&gt;
&lt;/yandex&gt;

</code></pre>
<h2 id="4-å»ºè¡¨">4. å»ºè¡¨</h2>
<p>ä¸¾ä¸ªä¾‹å­(å®é™…ä½¿ç”¨å¿…é¡»ç¡®å®šæ¸…æ¥š<strong>è¡¨å¼•æ“</strong>å’Œ<strong>èšåˆå‡½æ•°</strong>)ï¼Œè¿™é‡Œåªæ˜¯ç°åœºæƒ³ä¸ªä¾‹å­å±•ç¤ºé¢„èšåˆç”¨æ³•:</p>
<ul>
<li>è¡¨å¼•æ“ä½¿ç”¨: <code>MergeTree</code>ï¼Œç®€å•èšåˆå‡½æ•°</li>
<li>order byå°±æ˜¯ä¸»é”®äº†</li>
<li>æŒ‰æ—¶é—´åˆ†åŒº</li>
<li>å­˜å‚¨ç­–ç•¥æ˜¯ä¼˜å…ˆSSDï¼Œä¸Šé¢é‚£ä¸ª</li>
<li>å­˜å‚¨æ—¶é—´ä¸¤ä¸ªæœˆ</li>
</ul>
<pre><code class="language-sql">create table test.user_info
(
    record_time DateTime('Asia/Shanghai'),
    user String,
    cost Float64
)ENGINE = MergeTree()
ORDER BY (record_time,user)
PARTITION BY record_time
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'
TTL record_time + INTERVAL 2 MONTH

-- åˆ›å»ºç‰©åŒ–è§†å›¾ï¼Œæ¯”å¦‚æ¯å¤©æ¯ä¸ªç”¨æˆ·costæ€»é‡
CREATE MATERIALIZED VIEW user_info_daily_mv
ENGINE = SummingMergeTree()
PARTITION BY toYYYYMM(day)
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'
ORDER BY (day,user)
AS SELECT
    toStartOfDay(record_time) AS day,
    user ,
    sum(cost) as cost_count
FROM test.user_info
GROUP BY (day,user)
</code></pre>
<h1 id="é›†ç¾¤ç‰ˆå¸¦å‰¯æœ¬">é›†ç¾¤ç‰ˆï¼ˆå¸¦å‰¯æœ¬ï¼‰</h1>
<h2 id="1-zookeeperé›†ç¾¤éƒ¨ç½²">1. zookeeperé›†ç¾¤éƒ¨ç½²</h2>
<blockquote>
<p>æ­£å¼ç¯å¢ƒè²Œä¼¼è¦è®¾ç½®zookeeperçš„æ—¥å¿—æ¸…ç†</p>
</blockquote>
<h3 id="æµ‹è¯•ç”¨composeç›´æ¥èµ·">æµ‹è¯•ç”¨composeç›´æ¥èµ·</h3>
<pre><code>version: '3.1'

services:
  zoo1:
    image: zookeeper
    restart: always
    hostname: zoo1
    ports:
      - 2181:2181
    environment:
      ZOO_MY_ID: 1
      ZOO_SERVERS: server.1=0.0.0.0:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo2:
    image: zookeeper
    restart: always
    hostname: zoo2
    ports:
      - 2182:2181
    environment:
      ZOO_MY_ID: 2
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=0.0.0.0:2888:3888;2181 server.3=zoo3:2888:3888;2181

  zoo3:
    image: zookeeper
    restart: always
    hostname: zoo3
    ports:
      - 2183:2181
    environment:
      ZOO_MY_ID: 3
      ZOO_SERVERS: server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=0.0.0.0:2888:3888;2181
</code></pre>
<h3 id="æ‰‹åŠ¨å®‰è£…">æ‰‹åŠ¨å®‰è£…</h3>
<p>è¿™éƒ¨åˆ†åˆ äº†ï¼Œæ‰‹åŠ¨è£…æŒºéº»çƒ¦çš„ï¼Œè¿™éƒ¨åˆ†ä¸å¤§ç¡®å®šï¼Œè™½ç„¶æ˜¯èƒ½è·‘èµ·æ¥</p>
<h2 id="2-å®‰è£…clickhouse">2. å®‰è£…clickhouse</h2>
<p>åŒä¸Š</p>
<h2 id="3-æ›´æ–°é…ç½®2åˆ†ç‰‡2å‰¯æœ¬">3. æ›´æ–°é…ç½®(2åˆ†ç‰‡2å‰¯æœ¬)</h2>
<blockquote>
<p>ä¸å»ºè®®ä¸€ä¸ªclickhouse-serveræ‹¥æœ‰ä¸¤ä¸ªreplicasæ¥è‡ªä¸åŒshardã€‚ï¼ˆé™¤äº†æ€§èƒ½é—®é¢˜ï¼Œè¿˜ä¼šå­˜åœ¨åˆ†å¸ƒå¼DDLæ— æ³•ä½¿ç”¨ï¼‰<br>
è§<a href="https://altinity.com/blog/2018/5/10/circular-replication-cluster-topology-in-clickhouse">CIRCULAR REPLICATION CLUSTER TOPOLOGY IN CLICKHOUSE</a>ä¸­çš„è®¾è®¡å’Œ<a href="https://github.com/ClickHouse/ClickHouse/issues/7611">githubä¸Šissueæ‰€æçš„é—®é¢˜</a></p>
</blockquote>
<p>å³æ¯å°æœºå™¨æ˜¯ä»£è¡¨æŸä¸ªåˆ†ç‰‡çš„æŸä¸ªå‰¯æœ¬</p>
<h3 id="æ‰€æœ‰é…ç½®æ–‡ä»¶">æ‰€æœ‰é…ç½®æ–‡ä»¶</h3>
<ul>
<li>config.xml (ä¸»é…ç½®æ–‡ä»¶)</li>
<li>users.xml (ç”¨æˆ·åŠé…ç½®é™åˆ¶)</li>
<li>storeage.xml (å­˜å‚¨ä¸ç­–ç•¥é…ç½®)</li>
<li>metrika.xmlï¼ˆé›†ç¾¤é…ç½®ï¼‰</li>
</ul>
<h3 id="configxml-ä¸»é…ç½®æ–‡ä»¶">config.xml (ä¸»é…ç½®æ–‡ä»¶)</h3>
<pre><code>&lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt;
</code></pre>
<h3 id="storagexml-å­˜å‚¨ä¸ç­–ç•¥é…ç½®">storage.xml (å­˜å‚¨ä¸ç­–ç•¥é…ç½®)</h3>
<p>è§å•æœºç‰ˆï¼Œå†·çƒ­æ•°æ®åˆ’åˆ†ï¼Œå®é™…è§„åˆ™</p>
<ul>
<li>partè¶…è¿‡1Gçš„è¿ç§»</li>
<li>ssdå¿«ä¸å¤Ÿå®¹é‡æ—¶è¿ç§»</li>
</ul>
<h3 id="userxmlç”¨æˆ·é…ç½®">user.xml(ç”¨æˆ·é…ç½®ï¼‰</h3>
<ul>
<li>é…ç½®æ–‡ä»¶è§<a href="https://clickhouse.tech/docs/en/operations/settings/settings-users/">user settings</a></li>
<li>å¯ä»¥è®¾ç½®ä¸ªé»˜è®¤å¯†ç ï¼Œç”¨æˆ·è´¦å·ç®¡ç†ç”¨<a href="https://clickhouse.tech/docs/en/operations/access-rights/#access-control">SQL-driven workflow</a></li>
</ul>
<h3 id="metrikaxmlæ–‡ä»¶clusteré…ç½®">metrika.xmlæ–‡ä»¶ï¼ˆclusteré…ç½®ï¼‰</h3>
<ul>
<li>ç”³è¯·4å°æœºå™¨ï¼Œä¸¤ä¸ªåˆ†ç‰‡ï¼Œ2ä¸ªå‰¯æœ¬</li>
<li>1å’Œ2çš„æœºå™¨åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸‹ï¼Œ3å’Œ4åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸‹</li>
</ul>
<pre><code class="language-xml">&lt;yandex&gt;
    &lt;remote_servers&gt;
        &lt;test_cluster&gt;
            &lt;shard&gt;
                &lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;
                &lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;!-- Optional. Priority of the replica for load balancing (see also load_balancing setting). Default: 1 (less value has more priority). --&gt;
                    &lt;!-- &lt;priority&gt;1&lt;/priority&gt; --&gt;
                    &lt;host&gt;xx.xxx.xx.xx1&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx2&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
            &lt;shard&gt;
                &lt;weight&gt;1&lt;/weight&gt;
                &lt;internal_replication&gt;true&lt;/internal_replication&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx3&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
                &lt;replica&gt;
                    &lt;host&gt;xx.xxx.xx.xx4&lt;/host&gt;
                    &lt;port&gt;9000&lt;/port&gt;
                &lt;/replica&gt;
            &lt;/shard&gt;
        &lt;/test_cluster&gt;
    &lt;/remote_servers&gt;

    &lt;!-- è¿™é‡Œå…¶å®å°±æ˜¯æ ‡è®°å½“å‰æœºå™¨å±äºå“ªä¸ªshardï¼Œä»¥åŠå‰¯æœ¬ä»£å· --&gt;
    &lt;macros&gt;
        &lt;shard&gt;01&lt;/shard&gt;
        &lt;replica&gt;xx.xxx.xx.xx1&lt;replica&gt;
    &lt;/macros&gt;

    &lt;!-- ZK--&gt;
    &lt;zookeeper&gt;
        &lt;node index=&quot;1&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx1&lt;/host&gt;
            &lt;port&gt;2181&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index=&quot;2&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx2&lt;/host&gt;
            &lt;port&gt;2182&lt;/port&gt;
        &lt;/node&gt;
        &lt;node index=&quot;3&quot;&gt;
            &lt;host&gt;xx.xxx.xx.xx3&lt;/host&gt;
            &lt;port&gt;2183&lt;/port&gt;
        &lt;/node&gt;
    &lt;/zookeeper&gt;
    
&lt;/yandex&gt;
</code></pre>
<h3 id="å®å®šä¹‰ç»Ÿä¸€å»ºè¡¨è¯­å¥">å®å®šä¹‰(ç»Ÿä¸€å»ºè¡¨è¯­å¥)</h3>
<p>è¿™é‡Œä¸è®¾ç½®layerå±‚äº†ï¼Œæ²¡å¿…è¦</p>
<h4 id="è®°å¾—æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æ›´æ–°è¿™ä¸ª"><strong>è®°å¾—æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æ›´æ–°è¿™ä¸ªï¼ï¼ï¼</strong></h4>
<h4 id="æ³¨æ„åŒä¸€ä¸ªshardçš„èŠ‚ç‚¹çš„shardé…ç½®å¿…é¡»ä¸€è‡´"><strong>æ³¨æ„åŒä¸€ä¸ªshardçš„èŠ‚ç‚¹çš„shardé…ç½®å¿…é¡»ä¸€è‡´ï¼ï¼</strong></h4>
<pre><code class="language-xml">&lt;macros&gt;
    &lt;shard&gt;01&lt;/shard&gt;
    &lt;replica&gt;hostname&lt;/replica&gt;
&lt;/macros&gt;
</code></pre>
<h4 id="å»ºè¡¨å¦‚æœå¸¦ä¸Šshardæˆ–è€…replicaä¸èƒ½ä½¿ç”¨åˆ†å¸ƒå¼ddl">å»ºè¡¨å¦‚æœå¸¦ä¸Š{shard}æˆ–è€…{replica}ï¼Œä¸èƒ½ä½¿ç”¨åˆ†å¸ƒå¼DDL</h4>
<p>å…·ä½“è§<a href="https://clickhouse.tech/docs/en/engines/table-engines/mergetree-family/replication/">å®˜æ–¹æ–‡æ¡£replicationæè¿°</a></p>
<blockquote>
<p>The replica name identifies different replicas of the same table. You can use the server name for this, as in the example. The name only needs to be unique within each shard.<br>
You can define the parameters explicitly instead of using substitutions. This might be convenient for testing and for configuring small clusters. However, you canâ€™t use distributed DDL queries (ON CLUSTER) in this case.</p>
</blockquote>
<h3 id="æœ€ç»ˆé…ç½®æ–‡ä»¶">æœ€ç»ˆé…ç½®æ–‡ä»¶</h3>
<h4 id="ä¸¢åˆ°configdç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®">ä¸¢åˆ°config.dç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®</h4>
<ul>
<li>xxx.xmlï¼ˆåˆå¹¶äº†listené…ç½®å’Œstoreageé…ç½®ï¼‰</li>
<li>metrika.xmlï¼ˆå•ç‹¬ï¼Œè¿™éƒ¨åˆ†æ˜¯çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯ï¼‰</li>
</ul>
<h4 id="ç”¨æˆ·é…ç½®ä¸¢åˆ°userdç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®">ç”¨æˆ·é…ç½®ä¸¢åˆ°user.dç›®å½•ä¸‹è¦†ç›–é»˜è®¤é…ç½®</h4>
<ul>
<li>users.xml</li>
</ul>
<h3 id="é›†ç¾¤æ ·ä¾‹">é›†ç¾¤æ ·ä¾‹</h3>
<p>å…·ä½“å¯ä»¥å»æŸ¥çœ‹systemçš„clusterè¡¨ï¼Œçœ‹çœ‹é›†ç¾¤é…ç½®æ˜¯å¦ç”Ÿæ•ˆäº†</p>
<h2 id="4-æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨click-serverç¡®å®šäº’é€š">4. æ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨click server(ç¡®å®šäº’é€š)</h2>
<ul>
<li>9000ç«¯å£ç”¨äºclickhouseäº’é€šä¸clickhouse-client</li>
<li>8123ç«¯å£ä¸ºhttpè®¿é—®</li>
</ul>
<h2 id="5-å»ºè¡¨">5. å»ºè¡¨</h2>
<pre><code class="language-sql">/*åˆ†å¸ƒå¼DDLå»ºåº“*/
CREATE DATABASE test ON CLUSTER 'test_cluster'

/*æ¯å°æœºå™¨è·‘ä¸€æ¬¡å»ºè¡¨ï¼Œä½†é€šè¿‡å®å®šä¹‰å¯ä»¥ä¿è¯æ¯ä¸ªåº“å»ºè¡¨è¯­å¥ä¸€è‡´*/
CREATE TABLE test.test_info_local (
    ......
)ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/test/test_info_local','{replica}')
PARTITION BY record_time
ORDER BY (record_time)
TTL record_time + INTERVAL 6 MONTH
SETTINGS storage_policy = 'moving_from_ssd_to_hdd'

/*åˆ†å¸ƒå¼DDLå»ºç«‹åŸå§‹æ•°æ®åˆ†å¸ƒè¡¨*/
CREATE TABLE  test.test_info_local on CLUSTER 'test_cluster'
as test.test_info
ENGINE = Distributed(test_cluster,test,test_info_local,rand())

/*ä»¥ä¸‹ä¸å†™äº†ï¼ŒåŸºæœ¬çœ‹å®˜æ–¹æ–‡æ¡£è¯¦ç»†ç‚¹*/
/*ç‰©åŒ–è§†å›¾æœ‰å®é™…tableçš„ï¼Œåªä¸è¿‡é»˜è®¤éšè—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º*/


/*åˆ†å¸ƒå¼DDLåˆ›å»ºç‰©åŒ–è§†å›¾*/
/*è¿™é‡Œå› ä¸ºæå‰å»ºå¥½å¤åˆ¶è¡¨äº†ï¼Œä¸éœ€è¦å†è®¾ç½®engineé‚£äº›*/



/**åˆ†å¸ƒå¼DDL åˆ›å»ºå…¨å±€è§†å›¾*/

</code></pre>
<ul>
<li>æ¯ä¸ªå®ä¾‹è·‘ä¸€æ¬¡å»ºè¡¨</li>
<li>åˆ†å¸ƒå¼DDLè·‘ä¸€æ¬¡å°±å¤Ÿäº†</li>
</ul>
<h2 id="6-å®é™…åº”ç”¨">6. å®é™…åº”ç”¨</h2>
<h3 id="å†™æœ¬åœ°è¡¨">å†™æœ¬åœ°è¡¨</h3>
<p>æœ€å¥½ç›´æ¥å†™æœ¬åœ°è¡¨ï¼Œå› ä¸ºç›´æ¥å†™åˆ†å¸ƒå¼è¡¨ï¼Œåœ¨clickhouseä¸Šè¿˜è¦å†åŒæ­¥ä¸€æ¬¡ï¼Œå®é™…ä¸Šç›¸å½“äºåŒå†™äº†</p>
<h3 id="è¯»åˆ†å¸ƒå¼è¡¨">è¯»åˆ†å¸ƒå¼è¡¨</h3>
<h2 id="7-æµ‹è¯•">7. æµ‹è¯•</h2>
<p>æ€§èƒ½æ–¹é¢ç®€å•çš„å¯ä»¥çœ‹<a href="https://clickhouse.tech/docs/en/introduction/performance/">å®˜æ–¹è¯´æ˜</a>ï¼Œå°½é‡æ‰¹é‡å†™ï¼Œè¿™é‡Œå…¶å®è¿˜ä¼šæ¶‰åŠåˆ°clickhouseé‡Œpartçš„æ¦‚å¿µï¼Œä¸ç»†è¯´äº†</p>
<blockquote>
<p>We recommend inserting data in packets of at least 1000 rows, or no more than a single request per second.</p>
</blockquote>
<h2 id="8-ä¸ªäººç»éªŒ">8. ä¸ªäººç»éªŒ</h2>
<ul>
<li>è¡¨å¼•æ“è¦ç•™æ„æ¸…æ¥šï¼Œä¸ªäººä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„æ˜¯<code>SummingMergeTree</code>æˆ–è€…<code>AggregatingMergeTree</code>ï¼Œåˆ†å¸ƒå¼å°±åŠ ä¸ª<code>replica</code>å‰ç¼€</li>
<li>clickhouseå…è®¸ç›¸åŒä¸»é”®çš„æ•°æ®å­˜åœ¨ï¼Œæ˜¯å¦å»é‡ä»¥åŠå»é‡çš„è§„åˆ™å…·ä½“çœ‹è¡¨å¼•æ“å†³å®šã€‚</li>
<li>clickhouseä¸ä¿è¯part mergeçš„æ—¶æœºï¼Œè¿™ä¸ªæ˜¯å‘ï¼ŒæŸäº›å®é™…åº”ç”¨åœºæ™¯æ—¶å°±ä¼šæ„Ÿå—åˆ°çš„</li>
<li>å¯ä»¥å¯¹è§†å›¾å†è¿›è¡Œè§†å›¾çš„èšåˆï¼Œä¸è¿‡è¦æ³¨æ„ï¼Œæœ¬è´¨ä¸Šæ˜¯insertäº‹ä»¶è§¦å‘äº†è§†å›¾ï¼Œè§†å›¾å¹¶ä¸çŸ¥é“åŸè¡¨çš„æ•°æ®</li>
</ul>
<p>æœ‰é—®é¢˜æ¬¢è¿ç•™è¨€~</p>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://geraltxli.github.io/tag/NhcxUV7yk/" class="tag">
                    clickhouse
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://geraltxli.github.io/post/gridea-kuo-zhan/">
                  <h3 class="post-title">
                    Grideaæ‰©å±•(ä¸€)- ä»£ç é«˜äº®
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>





  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'f793622868010a23cf01',
        clientSecret: 'fe2e90c65c7c3ce7dfa52e619d8a807eee42fdc4',
        repo: 'geraltxli.github.io',
        owner: 'GeraltXLi',
        admin: ['GeraltXLi'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
